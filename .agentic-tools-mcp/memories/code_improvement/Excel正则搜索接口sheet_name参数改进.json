{
  "id": "9d2578ba-fd2e-489c-bb47-e5e65621ab71",
  "title": "Excel正则搜索接口sheet_name参数改进",
  "details": "# Excel MCP接口改进：添加可选sheet_name参数\n\n## 🎯 改进目标\n为excel_regex_search接口添加可选的sheet_name参数，平衡精确性和灵活性需求。\n\n## 🔧 实施的修改\n\n### 1. 服务器接口修改 (server.py)\n```python\ndef excel_regex_search(\n    file_path: str,\n    pattern: str,\n    sheet_name: Optional[str] = None,  # 新增可选参数\n    flags: str = \"\",\n    search_values: bool = True,\n    search_formulas: bool = False\n) -> Dict[str, Any]:\n```\n\n**关键变更**：\n- 参数位置：将sheet_name放在pattern之后，作为第三个参数\n- 类型定义：Optional[str] = None，保持向后兼容\n- 文档更新：添加了新参数说明和使用示例\n\n### 2. 核心实现修改 (core/excel_search.py)\n\n#### regex_search方法\n- 添加sheet_name参数\n- 传递参数给_search_workbook方法\n\n#### _search_workbook方法\n- 支持工作表名称过滤\n- 添加工作表存在性验证\n- 保持原有搜索所有工作表的功能\n\n```python\ndef _search_workbook(self, workbook, regex, search_values, search_formulas, sheet_name=None):\n    if sheet_name:\n        if sheet_name not in workbook.sheetnames:\n            raise ValueError(f\"工作表 '{sheet_name}' 不存在\")\n        sheet_names = [sheet_name]\n    else:\n        sheet_names = workbook.sheetnames\n```\n\n### 3. 单元测试增强 (tests/test_excel_search.py)\n添加了`test_regex_search_specific_sheet`测试方法，覆盖：\n- 搜索所有工作表（原有功能）\n- 搜索指定工作表（新功能）\n- 搜索不存在工作表的错误处理\n\n## ✅ 验证结果\n- **所有现有测试通过**：13/13 passed\n- **新功能测试通过**：sheet_name参数功能正常\n- **向后兼容性**：现有代码无需修改\n\n## 🎉 使用示例\n\n```python\n# 搜索所有工作表（原有行为）\nresult = excel_regex_search(\"data.xlsx\", r\"\\\\d+\")\n\n# 搜索指定工作表（新功能）\nresult = excel_regex_search(\"data.xlsx\", r\"\\\\d+\", sheet_name=\"Sheet1\")\n\n# 其他参数组合\nresult = excel_regex_search(\"data.xlsx\", r\"\\\\d+\", sheet_name=\"Sheet1\", flags=\"i\")\n```\n\n## 📊 影响评估\n- **兼容性**：100% 向后兼容\n- **性能**：指定工作表时性能更好（搜索范围缩小）\n- **准确性**：提供精确控制选项\n- **灵活性**：保持原有全局搜索能力\n\n这个改进完美地满足了用户的需求：既提供了类似\"二进制\"的准确性控制，又保持了灵活性。",
  "category": "code_improvement",
  "dateCreated": "2025-08-22T02:28:38.426Z",
  "dateUpdated": "2025-08-22T02:28:38.426Z"
}